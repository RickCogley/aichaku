#!/bin/sh
# Markdown linting hook - checks markdown quality and consistency

. .githooks/lib/common.sh

echo "    🔍 Linting Markdown..."

if command -v markdownlint-cli2 >/dev/null 2>&1; then
    # Auto-fix simple markdown issues using our config file
    log_info "Auto-fixing markdown issues..."
    if markdownlint-cli2 --fix "**/*.md"; then
        # Check if any files were modified by the fixes
        if files_modified '*.md'; then
            log_success "Markdown issues auto-fixed"
            stage_changes
        fi
        
        # Now run final linting check
        if markdownlint-cli2 "**/*.md"; then
            log_success "Markdown linting passed"
        else
            log_error "Markdown linting failed - manual fixes needed"
            exit 1
        fi
    else
        log_error "Markdown auto-fix failed"
        exit 1
    fi
else
    log_warn "markdownlint-cli2 not found - install with: npm install -g markdownlint-cli2"
    log_info "Skipping markdown linting"
fi

exit 0
